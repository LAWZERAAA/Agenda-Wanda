<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sistema de Agendamentos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background: #f8f8f8;
  padding: 20px;
  color: #333;
}
h2,h3{
  text-align:center;
}
.container{
  max-width:500px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:10px;
  box-shadow:0 0 10px rgba(0,0,0,0.1);
}

label{
  font-weight: bold;
}
input, select{
  width:100%;
  padding:10px;
  margin:8px 0;
  border:1px solid #ccc;
  border-radius:5px;
}

button{
  width:100%;
  padding:12px;
  background:#4CAF50;
  border:none;
  color:#fff;
  font-size:16px;
  border-radius:5px;
  cursor:pointer;
}
button:hover{
  background:#45a049;
}

.item{
  background:#eee;
  padding:10px;
  margin:10px 0;
  border-radius:5px;
}

.cancelar{
  background:#d9534f;
  margin-top:10px;
}
.cancelar:hover{
  background:#c9302c;
}

#sucesso{
  display:none;
  padding:10px;
  background:#4CAF50;
  color:#fff;
  margin-top:15px;
  border-radius:5px;
}

#adminArea, #adminLogin{
  margin-top:20px;
  display:none;
}
</style>
</head>
<body>

<div class="container">
  <h2>Agendamento</h2>

  <label>Nome</label>
  <input id="nome" type="text" placeholder="Seu nome" oninput="mostrarAgenda()">

  <label>Servi√ßo</label>
  <select id="servico"></select>

  <label>Data</label>
  <input id="data" type="date" onchange="atualizarHorarios()">

  <label>Hor√°rio</label>
  <select id="hora"></select>

  <button onclick="agendar()">Agendar</button>

  <div id="sucesso">Agendado com sucesso!</div>

  <h3>Meus Agendamentos</h3>
  <div id="agenda"></div>

  <hr>

  <button onclick="mostrarLogin()">√Årea do Administrador</button>

  <div id="adminLogin">
    <h3>Login do Administrador</h3>
    <input id="adminUser" placeholder="Usu√°rio">
    <input id="adminPass" type="password" placeholder="Senha">
    <button onclick="loginAdmin()">Entrar</button>
  </div>

  <div id="adminArea">
    <h3>Painel Administrativo</h3>
    <div id="agendaAdmin"></div>
    <button onclick="logoutAdmin()">Sair</button>
  </div>
</div>


<!-- =========================================
     JAVASCRIPT COMPLETO E FUNCIONANDO
========================================= -->
<script>
// =========================
// CONFIGURA√á√ÉO
// =========================

const telefoneWhatsApp = "5519992880591";

const horariosBase = ["08:00","09:00","10:00","11:00","13:00","14:00","15:00","16:00","17:00"];

const servicos = [
  { id: "estetica_pes", nome: "Est√©tica dos P√©s", precoTexto: "R$ 40,00", duracao: 60 },
  { id: "estetica_maos", nome: "Est√©tica das M√£os", precoTexto: "R$ 35,00", duracao: 60 },
  { id: "podologia_completa", nome: "Podologia Completa", precoTexto: "a partir de R$ 100,00", duracao: 60 },
  { id: "plastica_pes", nome: "Pl√°stica dos P√©s", precoTexto: "R$ 80,00", duracao: 60 }
];

let adminLogado = false;


// =========================
// FUN√á√ïES DE HORA
// =========================

function hhmmParaMinutos(hhmm){
  const [h,m] = hhmm.split(":").map(Number);
  return h*60 + m;
}

function intervalosSobrepoem(aInicio, aDur, bInicio, bDur){
  const aFim = aInicio + aDur;
  const bFim = bInicio + bDur;
  return (aInicio < bFim) && (bInicio < aFim);
}


// =========================
// POPULAR SERVI√áOS
// =========================

function popularServicos(){
  const sel = document.getElementById("servico");
  sel.innerHTML = `<option value="" disabled selected>Selecione o servi√ßo</option>`;
  servicos.forEach(s => {
    const op = document.createElement("option");
    op.value = s.id;
    op.textContent = `${s.nome} ‚Äî ${s.precoTexto} (1h)`;
    sel.appendChild(op);
  });
  sel.onchange = atualizarHorarios;
}


// =========================
// ATUALIZAR HOR√ÅRIOS
// =========================

function atualizarHorarios(){
  const data = document.getElementById("data").value;
  const servicoID = document.getElementById("servico").value;
  const horaSel = document.getElementById("hora");
  horaSel.innerHTML = "";

  if(!data || !servicoID){
    const op = document.createElement("option");
    op.textContent = "Selecione data e servi√ßo";
    op.disabled = true;
    op.selected = true;
    horaSel.appendChild(op);
    return;
  }

  const servico = servicos.find(s => s.id === servicoID);
  const agenda = JSON.parse(localStorage.getItem("agenda")) || [];

  const ocupados = agenda
      .filter(a => a.data === data)
      .map(a => ({
          inicio: hhmmParaMinutos(a.hora),
          dur: a.duracao
      }));

  horariosBase.forEach(hr => {
    const inicio = hhmmParaMinutos(hr);
    const conflita = ocupados.some(a =>
      intervalosSobrepoem(inicio, servico.duracao, a.inicio, a.dur)
    );

    if(!conflita){
      const op = document.createElement("option");
      op.value = hr;
      op.textContent = hr;
      horaSel.appendChild(op);
    }
  });

  if(horaSel.options.length === 0){
    const op = document.createElement("option");
    op.textContent = "Nenhum hor√°rio dispon√≠vel";
    op.disabled = true;
    op.selected = true;
    horaSel.appendChild(op);
  }
}


// =========================
// AGENDAR
// =========================

function agendar(){
  const nome = document.getElementById("nome").value.trim();
  const data = document.getElementById("data").value;
  const hora = document.getElementById("hora").value;
  const servicoID = document.getElementById("servico").value;

  if(!nome || !data || !hora || !servicoID){
    alert("Preencha todos os campos.");
    return;
  }

  const servico = servicos.find(s => s.id === servicoID);
  let agenda = JSON.parse(localStorage.getItem("agenda")) || [];

  const inicio = hhmmParaMinutos(hora);
  const conflito = agenda
      .filter(a => a.data === data)
      .some(a => intervalosSobrepoem(inicio, servico.duracao, hhmmParaMinutos(a.hora), a.duracao));

  if(conflito){
    alert("Este hor√°rio j√° est√° ocupado.");
    atualizarHorarios();
    return;
  }

  agenda.push({
    nome,
    data,
    hora,
    servico: servico.nome,
    precoTexto: servico.precoTexto,
    duracao: servico.duracao
  });

  localStorage.setItem("agenda", JSON.stringify(agenda));

  mostrarAgenda();
  atualizarHorarios();

  if(adminLogado) mostrarAgendaAdmin();

  document.getElementById("sucesso").style.display = "block";
  setTimeout(() => document.getElementById("sucesso").style.display = "none", 3000);

  const msg =
`Ol√°! üíÖ
Novo agendamento:

üë§ ${nome}
üíÜ ${servico.nome}
üíµ ${servico.precoTexto}
‚è±Ô∏è 1h
üìÖ ${data}
‚è∞ ${hora}`;

  window.open(`https://wa.me/${telefoneWhatsApp}?text=${encodeURIComponent(msg)}`);
}


// =========================
// MOSTRAR AGENDA DO CLIENTE
// =========================

function mostrarAgenda(){
  const div = document.getElementById("agenda");
  const nomeBusca = document.getElementById("nome").value.toLowerCase().trim();

  const agenda = JSON.parse(localStorage.getItem("agenda")) || [];

  div.innerHTML = "";

  const meus = agenda.filter(a => a.nome.toLowerCase() === nomeBusca);

  if(meus.length === 0){
    div.innerHTML = "<p>Nenhum agendamento encontrado.</p>";
    return;
  }

  meus.forEach((a,i) => {
    div.innerHTML += `
    <div class="item">
      <strong>${a.nome}</strong><br>
      ${a.servico} ‚Äî ${a.precoTexto}<br>
      ${a.data} √†s ${a.hora}<br>
      <button class="cancelar" onclick="cancelar(${i})">Cancelar</button>
    </div>`;
  });
}


// =========================
// CANCELAR
// =========================

function cancelar(i){
  let agenda = JSON.parse(localStorage.getItem("agenda")) || [];
  agenda.splice(i,1);
  localStorage.setItem("agenda", JSON.stringify(agenda));
  mostrarAgenda();
  atualizarHorarios();
  if(adminLogado) mostrarAgendaAdmin();
}


// =========================
// ADMIN
// =========================

const ADMIN_USER = "admin";
const ADMIN_PASS = "1234";

function mostrarLogin(){
  document.getElementById("adminLogin").style.display = "block";
}

function loginAdmin(){
  const u = document.getElementById("adminUser").value;
  const p = document.getElementById("adminPass").value;

  if(u === ADMIN_USER && p === ADMIN_PASS){
    adminLogado = true;
    document.getElementById("adminLogin").style.display = "none";
    document.getElementById("adminArea").style.display = "block";
    mostrarAgendaAdmin();
  } else {
    alert("Usu√°rio ou senha incorretos.");
  }
}

function mostrarAgendaAdmin(){
  const div = document.getElementById("agendaAdmin");
  const agenda = JSON.parse(localStorage.getItem("agenda")) || [];

  div.innerHTML = "";

  agenda.forEach(a => {
    div.innerHTML += `
    <div class="item">
      <strong>${a.nome}</strong><br>
      ${a.servico} ‚Äî ${a.precoTexto}<br>
      ${a.data} √†s ${a.hora}
    </div>`;
  });
}

function logoutAdmin(){
  adminLogado = false;
  document.getElementById("adminArea").style.display = "none";
}


// =========================
// INICIALIZA√á√ÉO
// =========================

window.onload = () => {
  popularServicos();
  atualizarHorarios();
};
</script>

</body>
</html>
