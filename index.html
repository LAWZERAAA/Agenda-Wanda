<!DOCTYPE html>
<html lang="pt-BR">

<head>
<meta charset="UTF-8">
<title>Sistema de Agendamentos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 20px;
}

.container{
  max-width: 600px;
  margin: auto;
  background: white;
  padding: 25px;
  border-radius: 10px;
  box-shadow: 0 0 10px #0002;
}

h2, h3{
  text-align: center;
}

label{
  font-weight: bold;
  margin-top: 10px;
  display: block;
}

input, select{
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  border: 1px solid #ccc;
  border-radius: 5px;
}

button{
  width: 100%;
  padding: 12px;
  background: #28a745;
  color: white;
  border: none;
  border-radius: 5px;
  margin-top: 15px;
  cursor: pointer;
  font-size: 16px;
}

button:hover{
  background: #218838;
}

.cancelar{
  background: #dc3545;
}
.cancelar:hover{
  background: #b52a37;
}

.item{
  background: #f0f0f0;
  padding: 10px;
  margin-top: 10px;
  border-radius: 5px;
}

#sucesso{
  display: none;
  margin-top: 10px;
  padding: 10px;
  background: #28a745;
  color: white;
  border-radius: 4px;
}

#adminArea, #adminLogin{
  display: none;
  margin-top: 20px;
}

#calendario table{
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

#calendario th{
  padding: 5px;
  background: #ddd;
}

#calendario td{
  padding: 8px;
  border: 1px solid #ccc;
}
</style>
</head>

<body>

<div class="container">

<h2>Agendamentos</h2>

<label>Nome</label>
<input id="nome" type="text" placeholder="Seu nome" oninput="mostrarAgenda()">

<label>WhatsApp para Contato</label>
<input id="contato" type="text" placeholder="(DDD) 99999-9999">

<label>Servi√ßo</label>
<select id="servico"></select>

<label>Data</label>
<input id="data" type="date" onchange="atualizarHorarios()">

<label>Hor√°rio</label>
<select id="hora"></select>

<div id="msgHorarios" style="color:#777;margin-top:5px;"></div>

<button onclick="agendar()">Agendar</button>

<div id="sucesso">Agendado com sucesso!</div>

<h3>Meus Agendamentos</h3>
<div id="agenda"></div>

<hr>

<button onclick="mostrarLogin()">√Årea do Administrador</button>

<div id="adminLogin">
  <h3>Login</h3>
  <input id="adminUser" placeholder="Usu√°rio">
  <input id="adminPass" type="password" placeholder="Senha">
  <button onclick="loginAdmin()">Entrar</button>
</div>

<div id="adminArea">
  <h3>Painel Administrativo</h3>

  <h3>Calend√°rio</h3>
  <div id="calendario"></div>

  <h3>Lista do Dia</h3>
  <div id="agendaAdmin"></div>

  <button onclick="logoutAdmin()">Sair</button>
</div>

</div>

<script>
// =========================
// CONFIGURA√á√ÉO
// =========================

const telefoneWhatsApp = "5519992880591";

const horariosBase = ["08:00","09:00","10:00","11:00","13:00","14:00","15:00","16:00","17:00"];

const servicos = [
  { id: "estetica_pes", nome: "Est√©tica dos P√©s", precoTexto: "R$ 40,00", duracao: 60 },
  { id: "estetica_maos", nome: "Est√©tica das M√£os", precoTexto: "R$ 35,00", duracao: 60 },
  { id: "podologia_completa", nome: "Podologia Completa", precoTexto: "a partir de R$ 100,00", duracao: 60 },
  { id: "plastica_pes", nome: "Pl√°stica dos P√©s", precoTexto: "R$ 80,00", duracao: 60 }
];

let adminLogado = false;


// =========================
// FUN√á√ïES DE HORA
// =========================

function hhmmParaMinutos(hhmm){
  const [h,m] = hhmm.split(":").map(Number);
  return h*60 + m;
}

function intervalosSobrepoem(aInicio, aDur, bInicio, bDur){
  return (aInicio < bInicio + bDur) && (bInicio < aInicio + aDur);
}


// =========================
// POPULAR SERVI√áOS
// =========================

function popularServicos(){
  const sel = document.getElementById("servico");
  sel.innerHTML = `<option value="" disabled selected>Selecione o servi√ßo</option>`;
  
  servicos.forEach(s => {
    const op = document.createElement("option");
    op.value = s.id;
    op.textContent = `${s.nome} ‚Äî ${s.precoTexto} (1h)`;
    sel.appendChild(op);
  });

  sel.onchange = atualizarHorarios;
}


// =========================
// ATUALIZAR HOR√ÅRIOS
// =========================

function atualizarHorarios(){
  const data = document.getElementById("data").value;
  const servicoID = document.getElementById("servico").value;
  const horaSel = document.getElementById("hora");
  const msg = document.getElementById("msgHorarios");

  horaSel.innerHTML = "";

  if(!data || !servicoID){
    msg.textContent = "Selecione data e servi√ßo.";
    return;
  }

  msg.textContent = "Carregando hor√°rios...";

  const servico = servicos.find(s => s.id === servicoID);
  const agenda = JSON.parse(localStorage.getItem("agenda")) || [];

  const ocupados = agenda
    .filter(a => a.data === data)
    .map(a => ({
      inicio: hhmmParaMinutos(a.hora),
      dur: a.duracao
    }));

  horariosBase.forEach(hr => {
    const inicio = hhmmParaMinutos(hr);
    const conflita = ocupados.some(a =>
      intervalosSobrepoem(inicio, servico.duracao, a.inicio, a.dur)
    );

    if(!conflita){
      const op = document.createElement("option");
      op.value = hr;
      op.textContent = hr;
      horaSel.appendChild(op);
    }
  });

  msg.textContent = horaSel.options.length > 0
    ? "Hor√°rios dispon√≠veis:"
    : "Nenhum hor√°rio dispon√≠vel nesta data.";
}


// =========================
// AGENDAR
// =========================

function agendar(){
  const nome = document.getElementById("nome").value.trim();
  const contato = document.getElementById("contato").value.trim();
  const data = document.getElementById("data").value;
  const hora = document.getElementById("hora").value;
  const servicoID = document.getElementById("servico").value;

  if(!nome || !contato || !data || !hora || !servicoID){
    alert("Preencha todos os campos.");
    return;
  }

  const servico = servicos.find(s => s.id === servicoID);
  let agenda = JSON.parse(localStorage.getItem("agenda")) || [];

  agenda.push({
    nome,
    contato,
    data,
    hora,
    servico: servico.nome,
    precoTexto: servico.precoTexto,
    duracao: servico.duracao
  });

  localStorage.setItem("agenda", JSON.stringify(agenda));

  document.getElementById("sucesso").style.display = "block";
  setTimeout(()=>document.getElementById("sucesso").style.display = "none",3000);

  mostrarAgenda();
  atualizarHorarios();

  if(adminLogado) mostrarAgendaAdmin();

  const msg =
`Ol√°! üíÖ
Novo agendamento:

üë§ ${nome}
üí¨ Contato: ${contato}
üíÜ ${servico.nome}
üíµ ${servico.precoTexto}
‚è±Ô∏è 1h
üìÖ ${data}
‚è∞ ${hora}`;

  window.open(`https://wa.me/${telefoneWhatsApp}?text=${encodeURIComponent(msg)}`);
}


// =========================
// MOSTRAR AGENDA DO CLIENTE
// =========================

function mostrarAgenda(){
  const div = document.getElementById("agenda");
  const nomeBusca = document.getElementById("nome").value.toLowerCase().trim();

  const agenda = JSON.parse(localStorage.getItem("agenda")) || [];

  const meus = agenda.filter(a => a.nome.toLowerCase() === nomeBusca);

  div.innerHTML = "";

  if(meus.length === 0){
    div.innerHTML = "<p>Nenhum agendamento encontrado.</p>";
    return;
  }

  meus.forEach((a,i) => {
    div.innerHTML += `
      <div class="item">
        <strong>${a.nome}</strong><br>
        ${a.servico} ‚Äî ${a.precoTexto}<br>
        WhatsApp: ${a.contato}<br>
        ${a.data} √†s ${a.hora}<br>
        <button class="cancelar" onclick="cancelar(${i})">Cancelar</button>
      </div>`;
  });
}


// =========================
// CANCELAR CLIENTE
// =========================

function cancelar(i){
  let agenda = JSON.parse(localStorage.getItem("agenda")) || [];
  agenda.splice(i,1);
  localStorage.setItem("agenda", JSON.stringify(agenda));

  mostrarAgenda();
  atualizarHorarios();
}


// =========================
// ADMIN
// =========================

const ADMIN_USER = "admin";
const ADMIN_PASS = "1234";

function mostrarLogin(){
  document.getElementById("adminLogin").style.display = "block";
}

function loginAdmin(){
  const u = document.getElementById("adminUser").value;
  const p = document.getElementById("adminPass").value;

  if(u === ADMIN_USER && p === ADMIN_PASS){
    adminLogado = true;
    document.getElementById("adminLogin").style.display = "none";
    document.getElementById("adminArea").style.display = "block";
    gerarCalendario();
  } else {
    alert("Credenciais incorretas.");
  }
}

function logoutAdmin(){
  adminLogado = false;
  document.getElementById("adminArea").style.display = "none";
}


// =========================
// CALEND√ÅRIO TIPO OUTLOOK
// =========================

function gerarCalendario(){
  const hoje = new Date();
  const ano = hoje.getFullYear();
  const mes = hoje.getMonth();

  const primeiroDia = new Date(ano, mes, 1);
  const ultimoDia = new Date(ano, mes+1, 0);

  let html = `<h4>${primeiroDia.toLocaleDateString('pt-BR',{month:'long',year:'numeric'})}</h4>`;
  html += "<table><tr>";

  const dias = ["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"];
  dias.forEach(d=>html += `<th>${d}</th>`);
  html += "</tr><tr>";

  let diaSemana = primeiroDia.getDay();
  for(let i=0;i<diaSemana;i++) html += "<td></td>";

  for(let dia=1; dia<=ultimoDia.getDate(); dia++){
    const dataStr = `${ano}-${String(mes+1).padStart(2,'0')}-${String(dia).padStart(2,'0')}`;

    const ag = JSON.parse(localStorage.getItem("agenda")) || [];
    const marcado = ag.some(a=>a.data===dataStr);

    html += `
      <td onclick="mostrarAgendaDoDia('${dataStr}')"
          style="cursor:pointer; background:${marcado?'#cce5ff':''}">
          ${dia}
      </td>
    `;

    if((dia + diaSemana) % 7 === 0) html += "</tr><tr>";
  }

  html += "</tr></table>";

  document.getElementById("calendario").innerHTML = html;
}


// =========================
// ADMIN VISUALIZA DIA
// =========================

function mostrarAgendaDoDia(data){
  const div = document.getElementById("agendaAdmin");
  const agenda = JSON.parse(localStorage.getItem("agenda")) || [];
  const lista = agenda.filter(a => a.data === data);

  let html = `<h3>Agendamentos em ${data}</h3>`;

  if(lista.length === 0){
    html += "<p>Nenhum agendamento.</p>";
  } else {
    lista.forEach((a,i)=>{
      html += `
        <div class="item">
        <strong>${a.nome}</strong> ‚Äî WhatsApp: ${a.contato}<br>
        ${a.servico} ‚Äî ${a.precoTexto}<br>
        ${a.hora}<br>
        <button class="cancelar" onclick="cancelarAdmin('${a.nome}','${a.contato}',${i})">Cancelar</button>
        </div>`;
    });
  }

  div.innerHTML = html;
}


// =========================
// ADMIN CANCELA + WHATSAPP
// =========================

function cancelarAdmin(nome, contato, index){
  if(!confirm("Deseja cancelar este hor√°rio?")) return;

  let agenda = JSON.parse(localStorage.getItem("agenda")) || [];
  const item = agenda[index];

  agenda.splice(index,1);
  localStorage.setItem("agenda", JSON.stringify(agenda));

  const msg =
`Ol√° ${nome}! ‚ùå
Seu agendamento foi cancelado pelo administrador.
Se desejar remarcar, estamos √† disposi√ß√£o.`;

  window.open(`https://wa.me/55${contato.replace(/\D/g,"")}?text=${encodeURIComponent(msg)}`);

  mostrarAgendaAdmin();
  gerarCalendario();
}


// =========================
// INICIALIZA√á√ÉO
// =========================

window.onload = () => {
  popularServicos();
  atualizarHorarios();
};

</script>

</body>
</html>
