<script>
const telefoneWhatsApp = "5519992880591"; 
const horariosBase = ["08:00","09:00","10:00","11:00","13:00","14:00","15:00","16:00","17:00"];
let adminLogado = false; // ğŸ”§ controle de admin

function atualizarHorarios(){
  const data = document.getElementById("data").value;
  const horaSelect = document.getElementById("hora");
  horaSelect.innerHTML = "";

  if(!data){
    let opt = document.createElement("option");
    opt.textContent = "Selecione uma data primeiro";
    opt.disabled = true;
    opt.selected = true;
    horaSelect.appendChild(opt);
    return;
  }

  let agenda = JSON.parse(localStorage.getItem("agenda")) || [];
  let ocupados = agenda.filter(a => a.data === data).map(a => a.hora);

  horariosBase.forEach(h => {
    if(!ocupados.includes(h)){
      let opt = document.createElement("option");
      opt.value = h;
      opt.textContent = h;
      horaSelect.appendChild(opt);
    }
  });

  if(horaSelect.options.length === 0){
    let opt = document.createElement("option");
    opt.textContent = "Nenhum horÃ¡rio disponÃ­vel";
    opt.disabled = true;
    opt.selected = true;
    horaSelect.appendChild(opt);
  }
}

function agendar(){
  const nome = document.getElementById("nome").value;
  const servico = document.getElementById("servico").value;
  const data = document.getElementById("data").value;
  const hora = document.getElementById("hora").value;
  const sucesso = document.getElementById("sucesso");

  sucesso.style.display="none";

  if(!nome||!data||!hora||!servico){
    alert("Preencha todos os campos corretamente");
    return;
  }

  let agenda = JSON.parse(localStorage.getItem("agenda")) || [];
  agenda.push({nome,servico,data,hora});
  localStorage.setItem("agenda",JSON.stringify(agenda));

  mostrarAgenda();
  atualizarHorarios();

  // ğŸ”§ Atualiza automaticamente o painel do admin
  if(adminLogado) mostrarAgendaAdmin();

  sucesso.style.display="block";
  setTimeout(()=>sucesso.style.display="none",4000);

  const msg =
`OlÃ¡! ğŸ’…
Novo agendamento:

ğŸ‘¤ ${nome}
ğŸ’† ${servico}
ğŸ“… ${data}
â° ${hora}`;

  window.open(`https://wa.me/${telefoneWhatsApp}?text=${encodeURIComponent(msg)}`,"_blank");

  document.getElementById("nome").value="";
}

function mostrarAgenda(){
  const div = document.getElementById("agenda");
  div.innerHTML="<h3>Meus Agendamentos</h3>";
  let agenda = JSON.parse(localStorage.getItem("agenda")) || [];
  const nomeCliente = document.getElementById("nome").value;

  agenda.forEach((a,i)=>{
    div.innerHTML+=`
      <div class="item">
        <strong>${a.nome}</strong><br>
        ${a.servico}<br>
        ${a.data} Ã s ${a.hora}
        ${a.nome===nomeCliente ? 
          `<button class="cancelar" onclick="cancelar(${i})">Cancelar</button>` 
          : ""}
      </div>`;
  });
}

function cancelar(i){
  let agenda = JSON.parse(localStorage.getItem("agenda")) || [];
  agenda.splice(i,1);
  localStorage.setItem("agenda",JSON.stringify(agenda));
  mostrarAgenda();
  atualizarHorarios();

  // ğŸ”§ Atualiza admin automaticamente
  if(adminLogado) mostrarAgendaAdmin();
}

// ğŸ”§ Ãrea do administrador
function mostrarLogin(){
  document.getElementById("adminLogin").style.display="block";
}

function loginAdmin(){
  const user = document.getElementById("adminUser").value;
  const pass = document.getElementById("adminPass").value;

  if(user==="admin" && pass==="1234"){
    adminLogado = true; // <--- controle admin
    document.getElementById("adminLogin").style.display="none";
    document.getElementById("adminArea").style.display="block";
    mostrarAgendaAdmin();
  } else {
    alert("UsuÃ¡rio ou senha incorretos");
  }
}

function mostrarAgendaAdmin(){
  const div = document.getElementById("agendaAdmin");
  div.innerHTML="<h3>Agenda Completa</h3>";

  let agenda = JSON.parse(localStorage.getItem("agenda")) || [];

  agenda.forEach((a)=>{
    div.innerHTML+=`
      <div class="item">
        <strong>${a.nome}</strong><br>
        ${a.servico}<br>
        ${a.data} Ã s ${a.hora}
      </div>`;
  });
}

function logoutAdmin(){
  adminLogado = false; // ğŸ”§ reset do status admin
  document.getElementById("adminArea").style.display="none";
  document.getElementById("adminLogin").style.display="none";
}

// Inicializa ao carregar
mostrarAgenda();
atualizarHorarios();
</script>
